<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generar Cotización - Digital Olivas</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body class="bg-light">
    
    <header>
        <div class="container">
            <div class="logo">
                <div class="logo-text">DIGITAL<span>OLIVAS</span></div>
            </div>
            <nav>
                <ul>
                    <li><a href="index.html">Volver al Inicio</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <div class="container cotizador-container">
        
        <div class="controls-area no-print">
            <h2><i class="fas fa-file-invoice"></i> Nueva Cotización</h2>
            <div class="input-grid">
                <div class="form-group">
                    <label>Nombre del Servicio / Producto</label>
                    <input type="text" id="descServicio" placeholder="Ej: Ploteo A1 Bond">
                </div>
                <div class="form-group small">
                    <label>Cantidad</label>
                    <input type="number" id="cantServicio" value="1" min="1">
                </div>
                <div class="form-group small">
                    <label>Precio Unitario (S/)</label>
                    <input type="number" id="precServicio" step="0.10" placeholder="0.00">
                </div>
                <div class="form-group btn-group-align">
                    <button onclick="agregarItem()" class="add-btn"><i class="fas fa-plus"></i> Agregar</button>
                </div>
            </div>
            
            <div class="client-controls">
                <div class="form-group">
                    <label>Cliente:</label>
                    <input type="text" id="inputCliente" placeholder="Nombre del cliente" oninput="actualizarCliente()">
                </div>
                <button onclick="imprimirCotizacion()" class="print-btn"><i class="fas fa-file-pdf"></i> Imprimir / Guardar PDF</button>
            </div>
        </div>

        <div class="invoice-sheet" id="areaImpresion">
            <div class="invoice-header">
                <div class="inv-logo">
                    <h1>DIGITAL OLIVAS</h1>
                    <p>RUC: 10123456789</p>
                    <p>Calle Principal #123, Ciudad</p>
                </div>
                <div class="inv-details">
                    <h3>COTIZACIÓN</h3>
                    <p><strong>Fecha:</strong> <span id="fechaHoy"></span></p>
                    <p><strong>Cliente:</strong> <span id="nombreCliente">Consumidor Final</span></p>
                </div>
            </div>

            <table class="invoice-table">
                <thead>
                    <tr>
                        <th style="width: 50px;">Item</th>
                        <th>Descripción</th>
                        <th style="width: 100px;">Cant.</th>
                        <th style="width: 120px;">P. Unit</th>
                        <th style="width: 120px;">Total</th>
                        <th class="no-print" style="width: 50px;"></th>
                    </tr>
                </thead>
                <tbody id="tablaCuerpo">
                    </tbody>
            </table>

            <div class="invoice-footer">
                <div class="totals-box">
                    <div class="total-row">
                        <span>Subtotal:</span>
                        <span id="valSubtotal">S/ 0.00</span>
                    </div>
                    <div class="total-row">
                        <span>IGV (18%):</span>
                        <span id="valIGV">S/ 0.00</span>
                    </div>
                    <div class="total-row grand-total">
                        <span>TOTAL:</span>
                        <span id="valTotal">S/ 0.00</span>
                    </div>
                </div>
            </div>
            
            <div class="terms">
                <p>Validez de la oferta: 15 días.</p>
                <p>Gracias por su preferencia.</p>
            </div>
        </div>
    </div>

    <script>
        let itemCounter = 1;

        // Poner fecha de hoy
        document.getElementById('fechaHoy').textContent = new Date().toLocaleDateString();

        function actualizarCliente() {
            const input = document.getElementById('inputCliente').value;
            document.getElementById('nombreCliente').innerText = input || 'Consumidor Final';
        }

        function agregarItem() {
            const desc = document.getElementById('descServicio').value;
            const cant = parseFloat(document.getElementById('cantServicio').value);
            const prec = parseFloat(document.getElementById('precServicio').value);

            if (!desc || isNaN(cant) || isNaN(prec)) {
                alert("Por favor complete todos los campos correctamente");
                return;
            }

            const totalLinea = cant * prec;
            const tbody = document.getElementById('tablaCuerpo');
            
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td>${itemCounter++}</td>
                <td style="text-align: left;">${desc}</td>
                <td>${cant}</td>
                <td>S/ ${prec.toFixed(2)}</td>
                <td class="row-total">S/ ${totalLinea.toFixed(2)}</td>
                <td class="no-print"><button onclick="eliminarFila(this)" class="delete-btn"><i class="fas fa-trash"></i></button></td>
            `;
            
            tbody.appendChild(tr);
            
            // Limpiar inputs
            document.getElementById('descServicio').value = '';
            document.getElementById('cantServicio').value = '1';
            document.getElementById('precServicio').value = '';
            document.getElementById('descServicio').focus();

            calcularTotales();
        }

        function eliminarFila(btn) {
            const row = btn.parentNode.parentNode;
            row.parentNode.removeChild(row);
            calcularTotales();
            // Nota: No reiniciamos el contador de items para mantener consistencia histórica, 
            // pero si quieres reordenar, se requeriría una función extra.
        }

        function calcularTotales() {
            const filas = document.querySelectorAll('#tablaCuerpo tr');
            let subtotal = 0;

            filas.forEach(fila => {
                const celdaTotal = fila.querySelector('.row-total').innerText;
                const valor = parseFloat(celdaTotal.replace('S/ ', ''));
                subtotal += valor;
            });

            // Asumiendo que los precios unitarios YA incluyen IGV? 
            // O es Subtotal + IGV?
            // Generalmente en cotizaciones B2B se calcula: Base Imponible + IGV = Total
            // Aquí haremos: La suma es el Subtotal (Valor Venta), luego calculamos IGV y sumamos.
            
            const igv = subtotal * 0.18;
            const total = subtotal + igv;

            document.getElementById('valSubtotal').innerText = 'S/ ' + subtotal.toFixed(2);
            document.getElementById('valIGV').innerText = 'S/ ' + igv.toFixed(2);
            document.getElementById('valTotal').innerText = 'S/ ' + total.toFixed(2);
        }

        function imprimirCotizacion() {
            window.print();
        }
    </script>
</body>
</html>